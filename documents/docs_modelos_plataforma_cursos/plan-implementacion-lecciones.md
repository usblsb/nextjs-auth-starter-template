# Plan de Implementaci√≥n: Sistema de Lecciones

## üìã Resumen Ejecutivo

Implementar un sistema de lecciones que sigue el mismo patr√≥n arquitect√≥nico y de dise√±o que los sistemas existentes de cursos y diapositivas, manteniendo coherencia visual y funcional.

### Objetivos Principales
- ‚úÖ Crear estructura de rutas `/lecciones/` y `/lecciones/[slug]/`
- ‚úÖ Implementar control de acceso basado en campo `features` (OPEN, FREE, PREMIUM)
- ‚úÖ Mantener coherencia visual con cursos y diapositivas
- ‚úÖ Filtrar contenido por estado "activo" √∫nicamente
- ‚úÖ Mostrar contenido granular seg√∫n permisos de usuario

---

## üèóÔ∏è Arquitectura del Sistema

### Base de Datos (DB2 - Solo Lectura)
- **Tabla**: `els_db_lecciones`
- **Campos Principales**:
  - `estado`: enum('borrador','activo','inactivo','archivado') - Solo mostrar 'activo'
  - `features`: VARCHAR(50) - Valores: "OPEN", "FREE", "PREMIUM"
  - `titulo`: varchar(255) - T√≠tulo de la lecci√≥n
  - `url_remota`: text - URL de imagen
  - `contenido_publico`: longtext - Contenido HTML p√∫blico
  - `contenido_privado`: longtext - Contenido HTML privado
  - `descripcion_corta`: LONGTEXT - Para grid
  - `meta_description`: varchar(500) - SEO
  - `meta_titulo`: varchar(500) - SEO
  - `slug`: varchar(255) - Para rutas

### Reglas de Acceso Implementadas

#### 1. Contenido P√∫blico (OPEN)
- **Usuario desconectado**: `contenido_publico` + mensaje "Reg√≠strate para ver m√°s"
- **Usuario conectado (cualquier tipo)**: `contenido_publico` sin mensajes

#### 2. Contenido Gratuito (FREE)
- **Usuario desconectado**: `contenido_publico` + mensaje "Reg√≠strate para ver m√°s"
- **Usuario conectado (FREE/PREMIUM cualquier estado)**: `contenido_privado` completo

#### 3. Contenido Premium (PREMIUM)
- **Usuario desconectado/FREE/PREMIUM caducado**: `contenido_publico` + mensaje "Actualiza a Premium para ver m√°s"
- **Usuario PREMIUM activo ('active', 'trialing')**: `contenido_privado` completo

---

## üöÄ FASE 1: Preparaci√≥n y Estructura Base

### 1.1 Creaci√≥n de Estructura de Archivos
```
app/lecciones/
‚îú‚îÄ‚îÄ page.tsx                 # Listado de lecciones (grid)
‚îú‚îÄ‚îÄ [slug]/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # Vista individual de lecci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ loading.tsx          # Loading state
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îî‚îÄ‚îÄ LeccionView.tsx  # Componente de vista individual
‚îú‚îÄ‚îÄ loading.tsx              # Loading del listado
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ LeccionCard.tsx      # Card para el grid
    ‚îú‚îÄ‚îÄ LeccionesGrid.tsx    # Grid container
    ‚îî‚îÄ‚îÄ SearchAndFilters.tsx # Filtros y b√∫squeda
```

**‚úÖ Checklist Fase 1.1:**
- [ ] Crear directorio `app/lecciones/`
- [ ] Crear archivo `app/lecciones/page.tsx`
- [ ] Crear directorio `app/lecciones/[slug]/`
- [ ] Crear archivo `app/lecciones/[slug]/page.tsx`
- [ ] Crear directorio `app/lecciones/components/`
- [ ] Crear directorio `app/lecciones/[slug]/components/`
- [ ] Crear archivos loading.tsx necesarios

### 1.2 Extensi√≥n del Servicio de Contenido
A√±adir m√©todos espec√≠ficos para lecciones en `@/lib/services`:

```typescript
// M√©todos necesarios:
- getLeccionesPaginados()
- getLeccionBySlug()
- getContenidoLeccion() // Similar a getContenidoCurso()
```

**‚úÖ Checklist Fase 1.2:**
- [ ] Examinar servicio existente `contenidoService`
- [ ] Identificar m√©todos de cursos a replicar para lecciones
- [ ] Implementar `getLeccionesPaginados()`
- [ ] Implementar `getLeccionBySlug()`
- [ ] Implementar `getContenidoLeccion()`
- [ ] A√±adir tipo TypeScript `Leccion` si no existe

---

## üöÄ FASE 2: Componentes de Interfaz

### 2.1 Componente LeccionCard (Grid)
Basado en `CursoCard.tsx`, mostrando:
- Imagen: `url_remota`
- T√≠tulo: `<h3>` con `titulo`
- Descripci√≥n: `<p>` con `descripcion_corta` (HTML removido)
- Badge de acceso seg√∫n `features`
- Fecha de creaci√≥n
- Link a `/lecciones/{slug}`

**‚úÖ Checklist Fase 2.1:**
- [ ] Copiar estructura base de `CursoCard.tsx`
- [ ] Adaptar props para tipo `Leccion`
- [ ] Implementar badges de acceso (OPEN/FREE/PREMIUM)
- [ ] Configurar aspect ratio de imagen
- [ ] A√±adir efectos hover y transiciones
- [ ] Procesar `descripcion_corta` removiendo HTML
- [ ] Configurar routing a `/lecciones/[slug]`

### 2.2 Componente LeccionesGrid
Container del grid, similar a `CursosGrid.tsx`:
- Grid responsivo
- Estado vac√≠o
- Skeleton loading states

**‚úÖ Checklist Fase 2.2:**
- [ ] Copiar estructura de `CursosGrid.tsx`
- [ ] Adaptar para componente `LeccionCard`
- [ ] Configurar grid responsivo (1-4 columnas)
- [ ] Implementar estado vac√≠o con mensaje apropiado
- [ ] A√±adir loading skeletons opcionales

### 2.3 Componente LeccionView (Vista Individual)
Basado en `CursoView.tsx`, con orden espec√≠fico:

1. **Imagen Principal**: `url_remota` con aspect ratio optimizado
2. **T√≠tulo**: `<h1>` con `titulo`
3. **Contenido Condicional**: Seg√∫n `features` y usuario
4. **Meta Informaci√≥n**: `meta_description` y `meta_titulo`

**‚úÖ Checklist Fase 2.3:**
- [ ] Copiar estructura base de `CursoView.tsx`
- [ ] Implementar orden espec√≠fico de elementos
- [ ] Configurar imagen principal con prioridad
- [ ] Implementar l√≥gica de contenido condicional
- [ ] A√±adir secci√≥n de meta informaci√≥n
- [ ] Configurar badges de acceso
- [ ] Implementar mensajes CTA seg√∫n tipo de usuario

---

## üöÄ FASE 3: P√°ginas y Routing

### 3.1 P√°gina de Listado (/lecciones)
Basada en `app/cursos/page.tsx`:
- Paginaci√≥n
- Filtros por `features`
- B√∫squeda por texto
- Ordenamiento
- Solo lecciones con estado "activo"

**‚úÖ Checklist Fase 3.1:**
- [ ] Copiar estructura de `app/cursos/page.tsx`
- [ ] Configurar llamada a `getLeccionesPaginados()`
- [ ] Implementar filtros espec√≠ficos de lecciones
- [ ] Configurar metadatos SEO
- [ ] A√±adir breadcrumbs si necesario
- [ ] Implementar contador de resultados
- [ ] A√±adir componente de paginaci√≥n

### 3.2 P√°gina Individual (/lecciones/[slug])
Basada en `app/cursos/[slug]/page.tsx`:
- Obtenci√≥n de datos por slug
- Manejo de 404
- Metadatos din√°micos
- Detecci√≥n de tipo de usuario

**‚úÖ Checklist Fase 3.2:**
- [ ] Copiar estructura de `app/cursos/[slug]/page.tsx`
- [ ] Configurar llamada a `getLeccionBySlug()`
- [ ] Implementar `generateMetadata()` din√°mico
- [ ] Configurar manejo de errores 404
- [ ] Integrar detecci√≥n de tipo de usuario
- [ ] Configurar `LeccionView` component

### 3.3 Componentes de B√∫squeda y Filtros
Reutilizar o adaptar componentes existentes:
- SearchAndFilters
- Pagination

**‚úÖ Checklist Fase 3.3:**
- [ ] Evaluar reutilizaci√≥n de componentes existentes
- [ ] Adaptar filtros espec√≠ficos para lecciones
- [ ] Configurar opciones de filtro por `features`
- [ ] Implementar b√∫squeda por t√≠tulo/descripci√≥n
- [ ] A√±adir ordenamiento por fecha/t√≠tulo

---

## üöÄ FASE 4: L√≥gica de Acceso y Contenido

### 4.1 Implementaci√≥n de Control de Acceso
Basado en `contenidoService.getContenidoCurso()`:

```typescript
getContenidoLeccion(leccion: Leccion, tipoUsuario: TipoUsuario) {
  // L√≥gica espec√≠fica seg√∫n features y tipoUsuario
}
```

**‚úÖ Checklist Fase 4.1:**
- [ ] Implementar l√≥gica para contenido OPEN
- [ ] Implementar l√≥gica para contenido FREE
- [ ] Implementar l√≥gica para contenido PREMIUM  
- [ ] A√±adir mensajes contextuales apropiados
- [ ] Manejar casos edge (features null/undefined)
- [ ] Testear todas las combinaciones usuario/contenido

### 4.2 Mensajes y CTA seg√∫n Usuario
- Usuario sin login: "Reg√≠strate para ver m√°s"
- Usuario FREE con contenido PREMIUM: "Actualiza a Premium para ver m√°s"
- Botones de acci√≥n apropiados

**‚úÖ Checklist Fase 4.2:**
- [ ] Implementar mensajes contextuales
- [ ] Crear CTAs para registro
- [ ] Crear CTAs para upgrade Premium
- [ ] Dise√±ar cards informativos
- [ ] Configurar enlaces a p√°ginas de registro/upgrade

---

## üöÄ FASE 5: Estilizado y UX

### 5.1 Coherencia Visual
Mantener consistencia con cursos y diapositivas:
- Paleta de colores
- Typography
- Espaciado
- Animaciones
- Badges y componentes UI

**‚úÖ Checklist Fase 5.1:**
- [ ] Verificar uso de clases Tailwind consistentes
- [ ] Mantener paleta de colores existente
- [ ] Usar componentes UI/shadcn coherentes
- [ ] Replicar animaciones y transiciones
- [ ] Asegurar responsive design

### 5.2 Badges de Acceso Diferenciados
- OPEN: Badge secundario con icono Globe
- FREE: Badge outline con icono Shield
- PREMIUM: Badge amber con icono Lock

**‚úÖ Checklist Fase 5.2:**
- [ ] Implementar `AccessBadge` component reutilizable
- [ ] Configurar colores y estilos espec√≠ficos
- [ ] A√±adir iconos apropiados (lucide-react)
- [ ] Testear visibilidad y contraste
- [ ] Asegurar accesibilidad

---

## üöÄ FASE 6: Testing y Optimizaci√≥n

### 6.1 Pruebas Funcionales
- Todos los tipos de usuario y contenido
- Enlaces y navegaci√≥n
- Responsive design
- Estados de loading
- Manejo de errores

**‚úÖ Checklist Fase 6.1:**
- [ ] Probar usuario sin login + contenido OPEN
- [ ] Probar usuario sin login + contenido FREE
- [ ] Probar usuario sin login + contenido PREMIUM
- [ ] Probar usuario FREE + todos los contenidos  
- [ ] Probar usuario PREMIUM activo + todos los contenidos
- [ ] Probar usuario PREMIUM caducado + todos los contenidos
- [ ] Verificar paginaci√≥n y filtros
- [ ] Testear responsive en m√≥vil/tablet/desktop
- [ ] Verificar estados de loading
- [ ] Probar enlaces rotos y 404s

### 6.2 Performance y SEO
- Metadatos din√°micos
- Im√°genes optimizadas
- Core Web Vitals
- Estructura de datos LD+JSON si necesario

**‚úÖ Checklist Fase 6.2:**
- [ ] Verificar metadatos din√°micos funcionando
- [ ] Configurar images con Next.js Image
- [ ] Testear Core Web Vitals
- [ ] Validar HTML sem√°ntico
- [ ] Verificar indexabilidad para contenido OPEN

---

## üöÄ FASE 7: Integraci√≥n y Deployment

### 7.1 Integraci√≥n con Sistema Existente
- Verificar no conflictos con rutas
- Links desde otras secciones
- Navegaci√≥n global
- Sitemap updates

**‚úÖ Checklist Fase 7.1:**
- [ ] Verificar routing no conflict√∫a
- [ ] A√±adir links desde header/footer si necesario
- [ ] Actualizar navegaci√≥n principal
- [ ] Considerar a√±adir a sitemap.xml
- [ ] Verificar breadcrumbs si existen

### 7.2 Comandos de Build y Lint
- `pnpm build` sin errores
- `pnpm lint` sin warnings
- TypeScript compilation limpia
- Tests si existen

**‚úÖ Checklist Fase 7.2:**
- [ ] Ejecutar `pnpm build` y verificar √©xito
- [ ] Ejecutar `pnpm lint` y corregir issues
- [ ] Verificar TypeScript compilation
- [ ] Correr tests existentes
- [ ] Verificar no regresiones

---

## üìã Consideraciones T√©cnicas Espec√≠ficas

### Patrones a Seguir
1. **Reutilizar servicios existentes**: Extender `contenidoService`
2. **Mantener tipado TypeScript**: Usar/crear tipos apropiados
3. **Seguir convenciones**: Mismos patrones de naming y estructura
4. **HTML crudo**: Usar `dangerouslySetInnerHTML` para contenido
5. **Im√°genes**: Next.js Image component con optimizaci√≥n
6. **Estados**: Loading, error, y empty states consistentes

### Campos de Base de Datos
- ‚úÖ `estado = 'activo'` - Filtro obligatorio
- ‚úÖ `features` - Control de acceso granular
- ‚úÖ `url_remota` - Imagen principal
- ‚úÖ `contenido_publico` - HTML para usuarios sin acceso completo
- ‚úÖ `contenido_privado` - HTML para usuarios con acceso
- ‚úÖ `titulo` - H1 en vista individual, H3 en grid
- ‚úÖ `descripcion_corta` - Para cards del grid (remover HTML)
- ‚úÖ `meta_description` y `meta_titulo` - SEO din√°mico

### Arquitectura de Components
```
LeccionView
‚îú‚îÄ‚îÄ Imagen principal (url_remota)
‚îú‚îÄ‚îÄ T√≠tulo (H1)
‚îú‚îÄ‚îÄ ContentByPermission
‚îÇ   ‚îú‚îÄ‚îÄ Contenido HTML (p√∫blico/privado)
‚îÇ   ‚îú‚îÄ‚îÄ Mensajes contextuales
‚îÇ   ‚îî‚îÄ‚îÄ CTAs seg√∫n usuario
‚îî‚îÄ‚îÄ Meta informaci√≥n
```

---

## üéØ Entregables Finales

1. **‚úÖ Estructura completa `/lecciones/`** con p√°ginas y componentes
2. **‚úÖ Control de acceso funcional** seg√∫n reglas de negocio
3. **‚úÖ Coherencia visual** con sistema existente
4. **‚úÖ SEO optimizado** con metadatos din√°micos
5. **‚úÖ Responsive design** para todos los dispositivos
6. **‚úÖ Estados de loading/error** apropiados
7. **‚úÖ Performance optimizada** con Next.js best practices

---

## üìù Notas de Implementaci√≥n

- **Base de trabajo**: Usar cursos como template principal
- **Prioridad**: Funcionalidad primero, refinamiento despu√©s
- **Testing**: Probar cada combinaci√≥n usuario/contenido
- **Coherencia**: Mantener mismos patterns y convenciones
- **Performance**: Optimizar im√°genes y loading states
- **SEO**: Metadatos din√°micos para indexaci√≥n correcta

Este plan proporciona una hoja de ruta completa para implementar el sistema de lecciones manteniendo la calidad y coherencia del sistema existente.